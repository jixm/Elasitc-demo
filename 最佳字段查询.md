#### dis_max
> 参考Elasticsearch权威指南

添加数据

```bash

PUT /my_index/my_type/1
{
    "title": "Quick brown rabbits",
    "body":  "Brown rabbits are commonly seen."
}

PUT /my_index/my_type/2
{
    "title": "Keeping pets healthy",
    "body":  "My quick brown fox eats rabbits on a regular basis."
}
```
搜索Brown fox,bool查询结果文档1评分会高于文档2,采用dis_max查询(只将最佳匹配的评分作为查询的评分结果)可得到预期
的结果文档2评分高于文档1

```bash
{
    "query": {
        "dis_max": {
            "queries": [
                { "match": { "title": "Brown fox" }},
                { "match": { "body":  "Brown fox" }}
            ]
        }
    }
}

```
bool计算评分:

* 它会执行 should 语句中的两个查询。

* 加和两个查询的评分。

* 乘以匹配语句的总数。

* 除以所有语句总数（这里为：2）。

当用户搜索 “quick pets” 时,两个文档都包含quick,只有文档2包含pets,两个文档中都不具有同时包含 两个词,我们期望的结果是文档2的评分高,然而结果两个文档评分是一致的,一个简单的 dis_max 查询会采用单个最佳匹配字段， 而忽略其他的匹配

解决方案:可以通过指定 tie_breaker 这个参数将其他匹配语句的评分也考虑其中：
```bash
{
    "query": {
        "dis_max": {
            "queries": [
                { "match": { "title": "Quick pets" }},
                { "match": { "body":  "Quick pets" }}
            ],
            "tie_breaker": 0.3
        }
    }
}
```
> tie_breaker 参数提供了一种 dis_max 和 bool 之间的折中选择，它的评分方式如下：

> 获得最佳匹配语句的评分 _score 。
> 将其他匹配语句的评分结果与 tie_breaker 相乘。
> 对以上评分求和并规范化。
> 有了 tie_breaker ，会考虑所有匹配语句，但最佳匹配语句依然占最终结果里的很大一部分。
> tie_breaker 可以是 0 到 1 之间的浮点数,最合理的是(0.1 ~ 0.4)



#### best_fields

查询的类型是 best_fields ， 这表示它会为每个字段生成一个 match 查询，然后将它们组合到 dis_max 查询的内部

用 multi_match 重写成更简洁的形式：
```bash
{
    "multi_match": {
        "query":                "Quick brown fox",
        "type":                 "best_fields", 
        "fields":               [ "title", "body" ],
        "tie_breaker":          0.3,
        "minimum_should_match": "30%" 
    }
}
```

#### most_fields

> 我们希望将所有匹配字段的评分合并起来，所以使用 most_fields 类型。这让 multi_match 查询用 bool 
> 查询将两个字段语句包在里面，而不是使用 dis_max 查询。
```bash
上面这个查询用 multi_match 重写成更简洁的形式：

{
    "multi_match": {
        "query":                "Quick brown fox",
        "type":                 "best_fields", 
        "fields":               [ "title", "body" ],
        "tie_breaker":          0.3,
        "minimum_should_match": "30%" 
    }
}
```

